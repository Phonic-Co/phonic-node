/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { PhonicClient } from "../../src/Client";

describe("Conversations", () => {
    test("outbound_call", async () => {
        const server = mockServerPool.createServer();
        const client = new PhonicClient({
            token: "test",
            environment: { base: server.baseUrl, production: server.baseUrl },
        });
        const rawRequestBody = {
            to_phone_number: "+19189397081",
            config: {
                agent: "support-agent",
                welcome_message: "Hi {{customer_name}}. How can I help you today?",
                system_prompt: "You are an expert in {{subject}}. Be friendly, helpful and concise.",
                template_variables: { customer_name: "David", subject: "Chess" },
                voice_id: "sarah",
                no_input_poke_sec: 30,
                no_input_poke_text: "Are you still there?",
                no_input_end_conversation_sec: 180,
                boosted_keywords: ["Load ID", "dispatch"],
                tools: ["keypad_input"],
            },
        };
        const rawResponseBody = { conversation_id: "conv_12cf6e88-c254-233e-a149-b2f1bdd22783" };
        server
            .mockEndpoint()
            .post("/conversations/outbound_call")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversations.outboundCall({
            to_phone_number: "+19189397081",
            config: {
                agent: "support-agent",
                welcome_message: "Hi {{customer_name}}. How can I help you today?",
                system_prompt: "You are an expert in {{subject}}. Be friendly, helpful and concise.",
                template_variables: {
                    customer_name: "David",
                    subject: "Chess",
                },
                voice_id: "sarah",
                no_input_poke_sec: 30,
                no_input_poke_text: "Are you still there?",
                no_input_end_conversation_sec: 180,
                boosted_keywords: ["Load ID", "dispatch"],
                tools: ["keypad_input"],
            },
        });
        expect(response).toEqual({
            conversation_id: "conv_12cf6e88-c254-233e-a149-b2f1bdd22783",
        });
    });
});
